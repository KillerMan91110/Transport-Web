<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head >
    <title>LISTADO</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <th:block th:replace="fragmentos/other/common_style :: bootstrap5-sa"></th:block>
    <!-- Libreria JQUERY -->
    <script th:src="@{/js/jquery-3.6.3.min.js}"></script>
    <!-- Bloque de Scripts de Datatable -->
    <th:block th:replace="fragmentos/datatable/head :: dataTableHead"></th:block>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        function Eliminar(opcion) {
            event.preventDefault();
            Swal.fire({
                title: '¿Eliminar?',
                text: "Esta desicion no se podra revertir",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Eliminar',
                allowOutsideClick: false,
                allowEscapeKey: false
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Eliminar',
                        text: 'Eliminado correctamente',
                        icon: 'success',
                        allowOutsideClick: false,
                        allowEscapeKey: false
                    }).then((result) => {
                        if (result.isConfirmed) {
                            location.href = opcion.href;
                        }
                    });
                }
            });
        }
        //
        // function Actualizar() {
        //     event.preventDefault();
        //     Swal.fire({
        //         title: 'Desea actualizar los cambios?',
        //         text: '',
        //         showDenyButton: true,
        //         confirmButtonText: 'Sí, actualizar',
        //         denyButtonText: `No actualizar`
        //     }).then((result) => {
        //         if (result.isConfirmed) {
        //             Swal.fire(
        //                 'Éxito!',
        //                 'Registro actualizado :)',
        //                 'success'
        //             ).then((result) => {
        //                 if (result.isConfirmed) {
        //                     const form1 = document.getElementById("actualizar");
        //                     form1.submit();
        //                 }
        //             });
        //         } else if (result.isDenied) {
        //             Swal.fire('Los cambios no se han actualizado', '', 'info');
        //         }
        //     });
        // }
        //
        // function Editar() {
        //     const exampleModal = document.getElementById('modalEditar');
        //     exampleModal.addEventListener('show.bs.modal', event => {
        //         const button = event.relatedTarget;
        //
        //         // Datos
        //         const Id = button.getAttribute('data-bs-id');
        //         const PuntoPartida = button.getAttribute('data-bs-PuntoPartida');
        //         const PuntoLlegada = button.getAttribute('data-bs-PuntoLlegada');
        //         const Destinatario = button.getAttribute('data-bs-Destinatario');
        //         const DocumentoDestinatario = button.getAttribute('data-bs-DocumentoDestinatario');
        //         const Proveedor = button.getAttribute('data-bs-Proveedor');
        //         const DocumentoProveedor = button.getAttribute('data-bs-DocumentoProveedor');
        //         const MotivoTraslado = button.getAttribute('data-bs-MotivoTraslado');
        //         const ModalidadTraslado = button.getAttribute('data-bs-ModalidadTraslado');
        //         const FechaEmision = button.getAttribute('data-bs-FechaEmision');
        //         const HoraEmision = button.getAttribute('data-bs-HoraEmision');
        //         const FechaTraslado = button.getAttribute('data-bs-FechaTraslado');
        //         const NumeroPedido = button.getAttribute('data-bs-NumeroPedido');
        //         const RazonSocialTransportista = button.getAttribute('data-bs-RazonSocialTransportista');
        //         const RUCTransportista = button.getAttribute('data-bs-RUCTransportista');
        //         const NumeroMTC = button.getAttribute('data-bs-NumeroMTC');
        //         const Conductor = button.getAttribute('data-bs-Conductor');
        //         const DocumentoConductor = button.getAttribute('data-bs-DocumentoConductor');
        //         const NumeroLicencia = button.getAttribute('data-bs-NumeroLicencia');
        //         const NumeroPlaca = button.getAttribute('data-bs-NumeroPlaca');
        //
        //         // Campos
        //         const campoId = document.getElementById("id");
        //         const campoPuntoPartida = document.getElementById("PuntoPartida");
        //         const campoPuntoLlegada = document.getElementById("PuntoLlegada");
        //         const campoDestinatario = document.getElementById("Destinatario");
        //         const campoDocumentoDestinatario = document.getElementById("DocumentoDestinatario");
        //         const campoProveedor = document.getElementById("Proveedor");
        //         const campoDocumentoProveedor = document.getElementById("DocumentoProveedor");
        //         const campoMotivoTraslado = document.getElementById("MotivoTraslado");
        //         const campoModalidadTraslado = document.getElementById("ModalidadTraslado");
        //         const campoFechaEmision = document.getElementById("FechaEmision");
        //         const campoHoraEmision = document.getElementById("HoraEmision");
        //         const campoFechaTraslado = document.getElementById("FechaTraslado");
        //         const campoNumeroPedido = document.getElementById("NumeroPedido");
        //         const campoRazonSocialTransportista = document.getElementById("RazonSocialTransportista");
        //         const campoRUCTransportista = document.getElementById("RUCTransportista");
        //         const campoNumeroMTC = document.getElementById("NumeroMTC");
        //         const campoConductor = document.getElementById("Conductor");
        //         const campoDocumentoConductor = document.getElementById("DocumentoConductor");
        //         const campoNumeroLicencia = document.getElementById("NumeroLicencia");
        //         const campoNumeroPlaca = document.getElementById("NumeroPlaca");
        //
        //         // Colocar los datos a los campos
        //         campoId.value = Id;
        //         campoPuntoPartida.value = PuntoPartida;
        //         campoPuntoLlegada.value = PuntoLlegada;
        //         campoDestinatario.value = Destinatario;
        //         campoDocumentoDestinatario.value = DocumentoDestinatario;
        //         campoProveedor.value = Proveedor;
        //         campoDocumentoProveedor.value = DocumentoProveedor;
        //         campoMotivoTraslado.value = MotivoTraslado;
        //         campoModalidadTraslado.value = ModalidadTraslado;
        //         campoFechaEmision.value = FechaEmision;
        //         campoHoraEmision.value = HoraEmision;
        //         campoFechaTraslado.value = FechaTraslado;
        //         campoNumeroPedido.value = NumeroPedido;
        //         campoRazonSocialTransportista.value = RazonSocialTransportista;
        //         campoRUCTransportista.value = RUCTransportista;
        //         campoNumeroMTC.value = NumeroMTC;
        //         campoConductor.value = Conductor;
        //         campoDocumentoConductor.value = DocumentoConductor;
        //         campoNumeroLicencia.value = NumeroLicencia;
        //         campoNumeroPlaca.value = NumeroPlaca;
        //     });
        // }
    </script>
</head>
<body>
<header>
    <div th:replace="menu :: NavBar"></div>
</header>
<main>

    <hr class="container mt-5">
    <th:block th:replace="menu :: NavList"></th:block>
    <hr class="container">
    <div class="container">
        <div class="alert alert-danger my-2 text-center" role="alert"><b>LISTADO GUIA DE REMISION</b></div>
        <hr class="container">
    </div>
    <div class="container mb-5" style="width: 100%">
        <table id="myTable" class="table table-striped nowrap " style="width:100%">
            <thead>
            <tr>
                <th>#</th>
                <th>ID</th>
                <th>Punto de Partida</th>
                <th>Punto de Llegada</th>
                <th>Destinatario</th>
                <th>Documento del Destinatario</th>
                <th>Proveedor</th>
                <th>Documento del Proveedor</th>
                <th>Motivo del Traslado</th>
                <th>Modalidad del Traslado</th>
                <th>Fecha de Emisión</th>
                <th>Hora de Emisión</th>
                <th>Fecha de Traslado</th>
                <th>Número de Pedido</th>
                <th>Razón Social del Transportista</th>
                <th>RUC del Transportista</th>
                <th>Número de MTC</th>
                <th>Conductor</th>
                <th>Documento del Conductor</th>
                <th>Número de Licencia</th>
                <th>Número de Placa</th>
                <th>Estado</th>
                <th sec:authorize="hasAnyAuthority('ADMINISTRADOR')">Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="guia_remision,status : ${GuiaRemision}" th:if="${guia_remision.id != ''}">
                <td th:text="${status.count}"></td>
                <td th:text="${guia_remision.id}"></td>
                <td th:text="${guia_remision.puntoPartida}"></td>
                <td th:text="${guia_remision.puntoLlegada}"></td>
                <td th:text="${guia_remision.destinatario}"></td>
                <td th:text="${guia_remision.documentoDestinatario}"></td>
                <td th:text="${guia_remision.proveedor}"></td>
                <td th:text="${guia_remision.documentoProveedor}"></td>
                <td th:text="${guia_remision.motivoTraslado}"></td>
                <td th:text="${guia_remision.modalidadTraslado}"></td>
                <td th:text="${#dates.format(guia_remision.fechaEmision, 'dd-MMM-yyyy')}"></td>
                <td th:text="${guia_remision.horaEmision}"></td>
                <td th:text="${#dates.format(guia_remision.fechaTraslado, 'dd-MMM-yyyy')}"></td>
                <td th:text="${guia_remision.numeroPedido}"></td>
                <td th:text="${guia_remision.razonSocialTransportista}"></td>
                <td th:text="${guia_remision.RUCTransportista}"></td>
                <td th:text="${guia_remision.numeroMTC}"></td>
                <td th:text="${guia_remision.empleados.nombre}"></td>
                <td th:text="${guia_remision.empleados.dni}"></td>
                <td th:text="${guia_remision.empleados.num_licencia}"></td>
                <td th:text="${guia_remision.numeroPlaca}"></td>
                <td>
                    <select id="estado" class="form-select" th:attr="data-id=${guia_remision.id}">
                        <option th:each="estado : ${T(com.example.proyecto.web.transporte.guia_remision.Estado).values()}"
                                th:value="${estado}" th:text="${estado.displayValue}"
                                th:selected="${estado} == ${guia_remision.estado}">
                        </option>
                    </select>
                </td>
                <td class="d-flex" sec:authorize="hasAnyAuthority('ADMINISTRADOR')">
                    <a
                            th:onclick="editRecord([[${guia_remision.id}]])"
                            class="btn btn-info"
                            title="editar"
                    >
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a
                            href="#"
                            class="btn btn-danger btn-sm"
                            th:attr="id-item=${guia_remision.id}"
                            title="eliminar"
                    >
                        <!--th:onclick="deleteRecord(${contacto.id})"-->
                        <i class="bi bi-trash-fill"></i>
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div sec:authorize="hasAnyAuthority('ADMINISTRADOR')" class="modal fade" id="modalEditar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Actualizar Guia de Remision</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="PUT" id="actualizar" class="p-5">
                        <input type="hidden" name="id" id="id">
                        <div class="mb-3">
                            <label for="PuntoPartida" class="col-form-label">Punto de Partida:</label>
                            <input type="text" name="puntoPartida" id="PuntoPartida" placeholder="Ingrese Punto de Partida" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="PuntoLlegada" class="col-form-label">Punto de Llegada:</label>
                            <input type="text" name="puntoLlegada" id="PuntoLlegada" placeholder="Ingrese Punto de Llegada" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="Destinatario" class="col-form-label">Destinatario:</label>
                            <input type="text" name="destinatario" id="Destinatario" placeholder="Ingrese Destinatario" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="DocumentoDestinatario" class="col-form-label">Documento del Destinatario:</label>
                            <input type="text" name="documentoDestinatario" id="DocumentoDestinatario" placeholder="Ingrese Documento del Destinatario" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="Proveedor" class="col-form-label">Proveedor:</label>
                            <input type="text" name="proveedor" id="Proveedor" placeholder="Ingrese Proveedor" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="DocumentoProveedor" class="col-form-label">Documento del Proveedor:</label>
                            <input type="text" name="documentoProveedor" id="DocumentoProveedor" placeholder="Ingrese Documento del Proveedor" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="MotivoTraslado" class="col-form-label">Motivo del Traslado:</label>
                            <input type="text" name="motivoTraslado" id="MotivoTraslado" placeholder="Ingrese Motivo del Traslado" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="ModalidadTraslado" class="col-form-label">Modalidad del Traslado:</label>
                            <input type="text" name="modalidadTraslado" id="ModalidadTraslado" placeholder="Ingrese Modalidad del Traslado" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="FechaEmision" class="col-form-label">Fecha de Emisión:</label>
                            <input type="date" name="fechaEmision" id="FechaEmision" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="HoraEmision" class="col-form-label">Hora de Emisión:</label>
                            <input type="time" name="horaEmision" id="HoraEmision" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="FechaTraslado" class="col-form-label">Fecha de Traslado:</label>
                            <input type="date" name="fechaTraslado" id="FechaTraslado" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="NumeroPedido" class="col-form-label">Número de Pedido:</label>
                            <input type="text" name="numeroPedido" id="NumeroPedido" placeholder="Ingrese Número de Pedido" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="RazonSocialTransportista" class="col-form-label">Razón Social del Transportista:</label>
                            <input type="text" name="razonSocialTransportista" id="RazonSocialTransportista" placeholder="Ingrese Razón Social del Transportista" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="RUCTransportista" class="col-form-label">RUC del Transportista:</label>
                            <input type="text" name="ructransportista" id="rucTransportista" placeholder="Ingrese RUC del Transportista" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="NumeroMTC" class="col-form-label">Número de MTC:</label>
                            <input type="text" name="numeroMTC" id="NumeroMTC" placeholder="Ingrese Número de MTC" class="form-control">
                        </div>
                        <div class="mb-3 conductor-container">
                            <label for="conductor" class="form-label">Conductor</label>
                            <select id="conductor" name="idEmpleado" class="js-example-placeholder-single js-states form-control" required>
                                <option th:each="empleado : ${empleados}" th:value="${empleado.id}" th:text="|${empleado.nombre} - ${empleado.dni}|"></option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="NumeroPlaca" class="col-form-label">Número de Placa:</label>
                            <input type="text" name="numeroPlaca" id="NumeroPlaca" placeholder="Ingrese Número de Placa" class="form-control">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button onclick="actualizar()" type="button" class="btn btn-primary">Actualizar</button>
                </div>
            </div>
        </div>
    </div>

</main>
<footer>
    <div th:insert="menu :: #barraFooter"></div>
</footer>
<th:block th:replace="fragmentos/datatable/scripts :: dataTableScript"></th:block>
<script th:src="@{/js/datatables-demo.js}"></script>
<script th:src="@{/js/request/guia_remision_script.js}"></script>
<script sec:authorize="hasAnyAuthority('ADMINISTRADOR')">
    const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
        },
    });

    $(document).ready(function () {
        if (localStorage.getItem("Status")) {
            let status = localStorage.getItem("Status");
            Toast.fire({
                icon: "success",
                title: "<center>"+ status +"</center>",
            });
            localStorage.clear();
        }
    });

    $('#myTable tbody').on('click', 'a[title = eliminar]', function () {
        ///console.log($(this).attr("id-item"));
        const file = $(this).parents('tr');
        Swal.fire({
            title: "¿Estás seguro?",
            text: "No podrás revertir esto!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sí, eliminar!",
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    url: "/guiaRemision/guia/" + $(this).attr("id-item"),
                    type: "DELETE",
                    success: function () {
                        // Remove it
                        table.row(file)
                            .remove()
                            .draw();
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    },
                });
            }
        });

    });
</script>
</body>
</html>
